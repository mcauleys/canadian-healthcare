---
title: "R Notebook"
output: html_notebook
---

Import required libraries
```{r}
library(tidyverse)
```

Import data
```{r}
names <- read.csv("healthcare-investors-names.csv", header = TRUE)
country <- read.csv("healthcare-investors-country.csv", header = TRUE)
value <- read.csv("healthcare-investors-value.csv", header = TRUE)
os <- read.csv("healthcare-investors-os.csv", header = TRUE)

```


```{r}
df <- data.frame()

for (ticker in names(names)){
  
  if (names[,ticker][1] == "#N/A"){
    next()
  }
  
  investors <- as.character(names[,ticker][names[,ticker] != ""])
  tick <- rep(ticker, length(investors))
  loc <- as.character(country[,ticker][country[,ticker] != ""])
  val <- value[,ticker][!is.na(value[,ticker])]
  out <- os[,ticker][!is.na(os[,ticker])]
  
  t <- cbind(tick, investors, loc, val, out)
  
  df <- rbind(df,t)
}

df$tick <- as.character(df$tick)
df$tick[df$tick == "Ã¯..ABUS.US"] <- "ABUS.US"
df$tick <- sub("[.]", "-", df$tick)


df$val <- as.numeric(as.character(df$val))
df$out <- as.numeric(as.character(df$out))

```

Dominance of Bausch Health Companies
```{r}
df.company <- df %>% group_by(tick, cat) %>% summarise(total = sum(val))

df.company$total[df.company$tick == "BHC-US"]
sum(df.company$total[df.company$tick != "BHC-US"])

df[df$tick == "BHC-US",]

ggplot(df.company) +
  geom_col(aes(x = reorder(tick, -total), y = total, fill = cat)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Remove Bausch Health Companies from the analysis
```{r}
df <- df[df$tick != "BHC-US",]

```



```{r}
df.investor <- df %>% group_by(investors, loc) %>% summarise(count = n(), total = sum(val))
summary(df.investor)
```


```{r}
ylab = c(20, 40, 60, 80, 100, 120, 140, 180, 200)

png(file = "total-investments-v-number.png", width = 6, height = 3, units = 'in', res = 300)
ggplot(df.investor) +
  geom_point(aes(x = count, y = total), size = 2, colour = "#2d465f") +
  scale_y_continuous(labels = paste0(ylab, "M"), breaks = 10^6 * ylab) +
  scale_x_continuous(breaks = c(1:21)) +
  labs(y = "Total investment ($)", x = "Number of investments")
dev.off()

```

Summary of top 5 geographic regions
```{r}
sum(df.investor$total[df.investor$loc == "Germany"])

median(df.investor$count[df.investor$loc == "Germany"])

df.investor$total[df.investor$loc == "Germany"]
```

Add company catagory tags to analysis
```{r}
cats <- read.csv(file = "catagories2.csv", header = FALSE, stringsAsFactors = FALSE)
cats$V1[1] <- "ACST-CA"
cats$V1

cats <- unique(cats)

df <- cbind(df, cats$V2[match(unlist(df$tick), cats$V1)])

names(df) <- c("tick", "investors", "loc", "val", "out", "cat") 

rm(cats)
```

```{r}
df.catagory <- df %>% group_by(cat, loc) %>% summarise(total = sum(val))

sum(df$val[(df$loc == "Canada" & df$cat == "Commercial Therapeutics")])
sum(df$val[(df$loc == "Canada" & df$cat == "Commercial Therapeutics")]) / sum(df$val[(df$loc == "Canada")])

sum(df$val[(df$loc == "Canada" & df$cat == "Consumer Health")])
sum(df$val[(df$loc == "Canada" & df$cat == "Consumer Health")]) / sum(df$val[(df$loc == "Canada")])

sum(df$val[(df$loc == "Canada" & df$cat == "Healthcare Services")])
sum(df$val[(df$loc == "Canada" & df$cat == "Healthcare Services")]) / sum(df$val[(df$loc == "Canada")])

sum(df$val[(df$loc == "Canada" & df$cat == "Medical Devices")])
sum(df$val[(df$loc == "Canada" & df$cat == "Medical Devices")]) / sum(df$val[(df$loc == "Canada")])

sum(df$val[(df$loc == "Canada" & df$cat == "Medical Supplies")])
sum(df$val[(df$loc == "Canada" & df$cat == "Medical Supplies")]) / sum(df$val[(df$loc == "Canada")])

sum(df$val[(df$loc == "Canada" & df$cat == "Therapeutic R&D")])
sum(df$val[(df$loc == "Canada" & df$cat == "Therapeutic R&D")]) / sum(df$val[(df$loc == "Canada")])



sum(df$val[(df$loc == "United States" & df$cat == "Commercial Therapeutics")])
sum(df$val[(df$loc == "United States" & df$cat == "Commercial Therapeutics")]) / sum(df$val[(df$loc == "United States")])

sum(df$val[(df$loc == "United States" & df$cat == "Consumer Health")])
sum(df$val[(df$loc == "United States" & df$cat == "Consumer Health")]) / sum(df$val[(df$loc == "United States")])

sum(df$val[(df$loc == "United States" & df$cat == "Healthcare Services")])
sum(df$val[(df$loc == "United States" & df$cat == "Healthcare Services")]) / sum(df$val[(df$loc == "United States")])

sum(df$val[(df$loc == "United States" & df$cat == "Medical Devices")])
sum(df$val[(df$loc == "United States" & df$cat == "Medical Devices")]) / sum(df$val[(df$loc == "United States")])

sum(df$val[(df$loc == "United States" & df$cat == "Medical Supplies")])
sum(df$val[(df$loc == "United States" & df$cat == "Medical Supplies")]) / sum(df$val[(df$loc == "United States")])

sum(df$val[(df$loc == "United States" & df$cat == "Therapeutic R&D")])
sum(df$val[(df$loc == "United States" & df$cat == "Therapeutic R&D")]) / sum(df$val[(df$loc == "United States")])



sum(df$val[df$cat == "Commercial Therapeutics"])
sum(df$val[df$cat == "Commercial Therapeutics"]) / sum(df$val)

sum(df$val[df$cat == "Consumer Health"])
sum(df$val[df$cat == "Consumer Health"]) / sum(df$val)

sum(df$val[df$cat == "Healthcare Services"])
sum(df$val[df$cat == "Healthcare Services"]) / sum(df$val)

sum(df$val[df$cat == "Medical Devices"])
sum(df$val[df$cat == "Medical Devices"]) / sum(df$val)

sum(df$val[df$cat == "Medical Supplies"])
sum(df$val[df$cat == "Medical Supplies"]) / sum(df$val)

sum(df$val[df$cat == "Therapeutic R&D"])
sum(df$val[df$cat == "Therapeutic R&D"]) / sum(df$val)

```


```{r}

df.canada <- df.investor[(df.investor$loc == "Canada"),]
df.us <- df.investor[(df.investor$loc == "United States"),]

ggplot(df) +
  geom_col(aes(y = val, fill = cat)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```



```{r}

```


```{r}

tmp <- arrange(df.investor[df.investor$loc == "Canada",], desc(total))
tmp <- as.character(tmp$investors[1:10])

ggplot(df[df$investors %in% tmp,]) +
  geom_col(aes(x = investors, y = val, fill = cat)) +
   theme(axis.text.x = element_text(angle = 45, hjust = 1))


tmp <- arrange(df.investor[df.investor$loc == "United States",], desc(total))
tmp <- as.character(tmp$investors[1:10])

ggplot(df[df$investors %in% tmp,]) +
  geom_col(aes(x = investors, y = val, fill = cat)) +
   theme(axis.text.x = element_text(angle = 45, hjust = 1))



df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]
df$tick[df$investors == "Connor, Clark & Lunn Investment Management Ltd."]
df$tick[df$investors == "BMO Asset Management, Inc."]
df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]
df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]
df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]
df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]
df$tick[df$investors == "Fidelity (Canada) Asset Management ULC"]


```







